{% load static %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{% static 'css/movies.css' %}" />
    <link rel="stylesheet" href="{% static 'css/tables.css' %}" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
    />

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Nunito Sans:wght@600;700;800&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Signika:wght@500&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Open Sans:wght@600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap"
    />
  </head>
  <body>
    <div>
          <!-- Add Movie Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="contactModalLabel"> Add Movie </h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  <form id="contactForm" method="post">
                    {% csrf_token %}

                      <div class="form-group">
                          <label for="name"> Movie Title </label>
                          <input type="text" class="form-control" id="title" name="title" required>
                      </div>

                    <div class="modal--body">
                      <label for="email">Genre</label>
                      <select id="dataDropdown" class="form-control">
                        <option value="option"> Select...</option>
                      </select>


                    </div>
                      <div class="form-group" style="margin-top: 20px">
                        <label for="email">Price</label>
                        <input type="integer" class="form-control"name="price" id="price" required>
                    </div>

                    <div style="display: flex; flex-direction: column; gap:10px; margin-top:10px">
                      <label> Language </label>
                      <input type="text" class="form-control" id="language" name="language" required>
                      
                    </div>



                      <div class="py-4">
                        <button type="submit" class="btn btn-primary btn-block py-2">Add Movie </button>
                      </div>
                  
                  </form>
                  <div id="formResponse" class="mt-3"></div>
              </div>
          </div>
      </div>
  </div>




  <div>


<script>
  $(document).ready(function(){
    function test(moviID){
      console.log(moviID)
    }
  })


  function edit_movie(movieID){
    $('#edit').on('show.bs.modal', function(){
      console.log("modal open")
      // getting the genres from the backend
      $.ajax({
        url: '{% url "get_genres" %}',
        method: 'GET',
        success: function(data) {
            console.log('AJAX request successful');
            console.log('Genres data:', data);
            
            var dropdown = $('#editDropdown');
            dropdown.empty();
            
            data.forEach(function(item) {
                console.log('Processing item:', item.genre);
                dropdown.append($('<option></option>').attr('value', item.genre).text(item.genre));
            });
        },
        error: function(xhr, status, error) {
            console.error('AJAX request failed');
            console.error('Status:', status);
            console.error('Error:', error);
            alert('Failed to load data');
        }
    });


    // populating the form with movie being editted
      $.ajax({
        url: '{% url 'get-movie' 0 %}'.replace(/0/, movieID),
        method: 'GET',
        success: function(data) {
            console.log('AJAX request successful');
            console.log('Movie:', data.title);
               // Update form fields with the received data
            $('#contactModalLabel').val("Edit Movie; "+data.title);
            $('#edit_title').val(data.title);
            $('#editDropdown').val(data.type);
            $('#edit_price').val(data.price);
            
        },
        error: function(xhr, status, error) {
            console.error('AJAX request failed');
            console.error('Status:', status);
            console.error('Error:', error);
            alert('Failed to load data');
        }
    });


    // sending the edited movie to the database 
    $('#contactForm').on('submit', function(event){
      event.preventDefault();
      $.ajax({
          type: 'PUT',
          url: '{% url 'get-movie' 0 %}'.replace(/0/, movieID),
          data: {
              'title': $('#title').val(),
              'type': $('#dataDropdown').val(),
              'price': $('#price').val(),
              'thumbnail': $('#file').val(),
              'csrfmiddlewaretoken': '{{ csrf_token }}'
          },
          success: function(response){
              window.alert("Movie editted successfuly");
              $('#formResponse').text('Movie successfuly added');
              $('#edit_movie')[0].reset();
          },
          error: function(response){
              $('#formResponse').text('An error occurred. Please try again.');
          }
      });
  });

  
    })



  }
</script>

    <!-- Edit Movie Modal -->
<div class="modal fade" id="contactModalLabe" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
    <div class="modal-content"> 
        <div class="modal-header">
            <h5 class="modal-title" id="contactModalLabel"> Edit Movie </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form id="edit_movie" method="post">
              {% csrf_token %}

                <div class="form-group">
                    <label for="name"> Movie Title </label>
                    <input placeholder="movie" type="text" class="form-control" id="edit_title" name="title" required>
                </div>

              <div class="modal--body">
                <label for="email">Genre</label>
                <select id="editDropdown" class="form-control">
                  <option value="option"> Select...</option>
                </select>


              </div>
                <div class="form-group" style="margin-top: 20px">
                  <label for="email">Price</label>
                  <input type="integer" class="form-control"name="price" id="edit_price" required>
              </div>

              <div style="display: flex; flex-direction: column; gap:10px; margin-top:10px">
                <label> Upload thumbnail </label>
                <input type="file" name="file" id="file" accept=".png" required>
              </div>



                <div class="py-4">
                  <button type="submit" class="btn btn-primary btn-block py-2">Save Changes </button>
                </div>
            
            </form>
            <div id="formResponse" class="mt-3"></div>
        </div>
    </div>
</div>
</div>
</div>



    <div class="dashboard-11">
      <div class="main">
        <div class="content">
          <div class="center">
            <img
              class="data-icon"
              loading="lazy"
              alt=""
              src="{% static './public/frame.svg'%}"
            />
          </div>
          <div class="navigation-sidebar-menu-li2">
            <div class="menu-items-container">
              <div class="item-container-parent">
                <div class="item-container">
                  <div class="hide-bg-copy4"></div>
                </div>


              <a href="{% url 'home' %}" class="menu-item-link" style="text-decoration: none; color:#000"> 
                <div class="menu-itemstandard3">
                  <div class="menu-item-content">
                    <img
                      class="icon8"
                      loading="lazy"
                      alt=""
                      src="{% static './public/icon11.svg' %}"/>

                    <div class="label">
                      <b class="menu-item3">Dashboard</b>
                    </div>
                  </div>
                </div>
              </a>
            </div>

          <a href="{% url 'customers' %}" class="menu-item-link" style="text-decoration: none">
              <div class="frame-parent11">
                <div class="hide-bg-copy-wrapper1">
                  <div class="hide-bg-copy6"></div>
                </div>

                <div class="menu-itemstandard5">
                  <div class="iconlyregularlight3-user-group">
                    <img
                      class="iconlyregularlight3-user1"
                      alt=""
                      src="{% static './public/iconlyregularlight3-users.svg'%}"/>
                    <div class="menu-item-wrapper1">
                      <b class="menu-item4">Customers</b>
                    </div>
                  </div>
                </div>
              </div>
            </a>


            <a href="{% url 'movies' %}" class="menu-item-link" style="text-decoration: none; color: #fff; font-weight: 500">
              <div class="frame-parent11">
                <div class="hide-bg-copy-wrapper1">
                  <div class="hide-bg-copy5"></div>
                </div>
                <div class="menu-itemstandard4">
                  <div class="bx-movie-playsvg-group">
                    <img
                      class="bx-movie-playsvg-icon1"
                      alt=""
                      src="{% static './public/bxmovieplaysvgs.svg'%}"
                    />

                    <div class="menu-item-wrapper2">
                      <b class="menu-item5">Movies</b>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </a>


            <img
              class="divider-icon3"
              loading="lazy"
              alt=""
              src="{% static './public/divider-2.svg'%}"
            />
          </div>
        </div>
      </div>

      
      




      <div class="table-container">
        <div class="data-table" style="background-color: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(128, 128, 128, 0.2);">
          <div class="rectangle" style="width: 100%; height: 84px; border-radius: 12px; background-color: #FAFBFD; position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: -1;"></div>

          <div class="table" style="border-radius: 16px; padding-left: 20px; padding-right: 20px; padding-top: 10px;  display:flex; flex-direction: column; gap: 20px; margin-top: -14px">

            <div class="header" style="height:52px; border-radius: 16px; display: flex; flex-direction: row; justify-content: space-between; width: 100%">
                <div class="flex" style="display:flex; flex-direction: row; align-items: center; gap: 20px">
                  <b style="font-size: 20px"> Movies </b>
                    <button class="buttons-filled-no-icon-m" id="add"  data-toggle="modal" data-target="#contactModal">
                      <b class="add-customer" style="align: center; justisfy-content: center">Add Movie</b>
                   </button>
                </div>

                <!--- Search Bar -->
                <div class="form-elements-inputfields" style="align-items: center; height:42px">
                  <div class="bg7"></div>
                  <div class="bg8"></div>
                  <input class="input-label" id="custom-search"placeholder="Search" type="text" />
  
                  <div class="padding-10px-10px">Padding 10px 10px 10px 14px</div>
                  <img
                    class="vuesaxlinearsearch-normal-icon"
                    alt=""
                    src="{% static './public/vuesaxlinearsearchnormal.svg'%}"
                  />
                </div>
                <!--End of Button -->

            </div>  


            <table id="example" class="display" style="width:100%">
              <thead>
                  <tr style="color: #8E9EAD">
                      <th>ID</th>
                      <th>Title</th>
                      <th>Genre</th>
                      <th>Price</th>
                      <th>Language</th>
    
                      
                  </tr>
              </thead>
              <tbody>

                  <!-- Add more rows as needed -->
              </tbody>
          </table>

          </div>
          



        </div>


<!-- Table for the content -->      



<div class="main-content">
    <main class="main-bg-color1">
            <section class="main-bg1"></section>
          </main>
          <div class="nav1">
            <div class="header2">
              <div class="search1"></div>
              <div class="header-content">
                <div class="text2">
                  <b class="title2">Hi, Aliyon!</b>
                  <div class="body4">Let’s check your progress today</div>
                </div>
              </div>
              <div class="profile-container">
                <div class="profile-content">
                  <div class="divider1"></div>
                </div>
                <div class="profile1">
                  <div class="avatar3">
                    <div class="avatar4">
                      <div class="avatar5">
                        <img
                          class="outline-border-icon1"
                          alt=""
                          src="{% static './public/outline-border.svg'%}"
                        />

                        <img
                          class="image-icon1"
                          alt=""
                          src="{% static './public/image@2x.png'%}"
                        />

                        <div class="initials2">
                          <div class="background3"></div>
                          <div class="initials3">AB</div>
                        </div>
                        <div class="icon9">
                          <div class="background4"></div>
                          <img
                            class="essentials-user-circle1"
                            loading="lazy"
                            alt=""
                            src="{% static './public/essentials--usercircle.svg'%}"
                          />
                        </div>
                        <div class="add1">
                          <div class="background5"></div>
                          <img
                            class="basics-add1"
                            alt=""
                            src="{% static './public/basics--add.svg'%}"
                          />
                        </div>
                        <div class="counter-top1">
                          <div class="large4">
                            <div class="base6"></div>
                            <div class="div53">23</div>
                          </div>
                          <div class="medium4">
                            <div class="base7"></div>
                            <b class="b14">12</b>
                          </div>
                          <div class="small4">
                            <div class="base8"></div>
                            <b class="b15">17</b>
                          </div>
                        </div>
                        <div class="counter-bottom1">
                          <div class="large5">
                            <div class="base9"></div>
                            <div class="div54">23</div>
                          </div>
                          <div class="medium5">
                            <div class="base10"></div>
                            <b class="b16">12</b>
                          </div>
                          <div class="small5">
                            <div class="base11"></div>
                            <b class="b17">17</b>
                          </div>
                        </div>
                        <img
                          class="bottom-plus-icon1"
                          alt=""
                          src="{% static './public/bottom-plus.svg'%}"
                        />

                        <div class="indicator-bottom1">
                          <div class="large6"></div>
                          <div class="medium6"></div>
                          <div class="small6"></div>
                        </div>
                        <div class="indicator-top1">
                          <div class="large7"></div>
                          <div class="medium7"></div>
                          <div class="small7"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="text-frame">
                    <div class="text3">
                      <b class="title3">Aliyon Tembo</b>
                      <div class="body5">Admin</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="name2">
                <img class="search-icon1" alt="" src="{% static './public/search.svg'%}" />

                <div class="body6">Search...</div>
              </div>
              <img class="icon10" alt="" src="{% static './public/icon.svg'%}" />

              <img class="icon11" alt="" src="{% static './public/icon.svg'%}" />
            </div>
          </div>
          <img
            class="separator-icon1"
            loading="lazy"
            alt=""
            src="{% static './public/separator.sv'%}g"
          />
        </div>
      </div>
    </div>

    <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Popper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

<!-- DataTables -->
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<!-- DataTables Buttons (optional) -->
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>


<script>
      $(document).ready(function(){
        var table = $('#example').DataTable({
          dom: 'rtip',
        });

        $('#custom-search').on('keyup', function() {
          table.search(this.value).draw();
      });


        
       // Load data into dropdown when modal is shown
        



////////////// DRAW TABLE WITH BACKEND DATABASE ///////////////////

    // function to populate the table with database content
  function populateDataTable(data) {
      table.clear();
      // Add rows from API data
      data.forEach(item => {
          table.row.add([
              item.id,
              item.title,
              item.genre,
              item.price,
              item.language,

          ]).draw(false); // Draw added row without redrawing entire table
      });
  }

    /* Making API calls to get movies from the backend */
    $.ajax({
      url: '{% url "get_movies" %}', // API endpoint
      method: 'GET',
      dataType: 'json',
      success: function(data) {
        console.log("data", data)
          populateDataTable(data); // Call function to populate DataTable
      },
      error: function(xhr, status, error) {
          console.error('Error fetching data:', error);
      }
  });

  ////////////////// TABLE END //////////////////////////






  ////////////////////// EDITING A MOVIE ENTITY ////////////////////

    // Load data into dropdown when modal is shown
    $('#edit').on('show.bs.modal', function() {
      console.log("Modal is being shown");
      var movieID =  document.getElementById("id").innerHTML;
      console.log(movieID)
      
      $.ajax({
          url: '{% url 'get-movie' 1 %}'.replace(/0/, movieID.innerHTML),
          method: 'GET',
          success: function(data) {
              console.log('AJAX request successful');
              console.log('Genres data:', data);
                 // Update form fields with the received data
            $('#titleInput').val(data.title);
            $('#typeInput').val(data.type);
            $('#priceInput').val(data.price);
              
          },
          error: function(xhr, status, error) {
              console.error('AJAX request failed');
              console.error('Status:', status);
              console.error('Error:', error);
              alert('Failed to load data');
          }
      });

      
  });


    });

////////////////////// MOVIE EDIT END ///////////////////////////
</script>

<script>



  /////////////////////// ADD MOVIE TO THE BACKEND //////////////////////
        $(document).ready(function(){
          $('#contactModal').on('show.bs.modal', function() {
            console.log("Modal is being shown");
            
            $.ajax({
                url: '{% url "get_genres" %}',
                method: 'GET',
                success: function(data) {
                    console.log('AJAX request successful');
                    console.log('Genres data:', data);
                    
                    var dropdown = $('#dataDropdown');
                    dropdown.empty();
                    
                    data.forEach(function(item) {
                        console.log('Processing item:', item.genre);
                        dropdown.append($('<option></option>').attr('value', item.genre).text(item.genre));
                    });
                },
                error: function(xhr, status, error) {
                    console.error('AJAX request failed');
                    console.error('Status:', status);
                    console.error('Error:', error);
                    alert('Failed to load data');
                }
            });
        });

      //submit form 
      $('#contactForm').on('submit', function(event){
        //event.preventDefault();
        $.ajax({
            type: 'POST',
            url: '{% url "add_movie" %}',
            data: {
                'title': $('#title').val(),
                'genre': $('#dataDropdown').val(),
                'price': $('#price').val(),
                'language': $('#language').val(),
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response){
                $('#formResponse').text('Movie successfuly added');
                $('#contactForm')[0].reset();
            },
            error: function(response){
                $('#formResponse').text('An error occurred. Please try again.');
            }
        });
    });


    ////////////// ADD MOVIE END //////////////////////////////



        })

      </script>  
  </body>
</html>
